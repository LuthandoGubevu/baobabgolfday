rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is an authenticated admin
    function isAdmin() {
      return request.auth != null && request.auth.token.email in ["roslyn@baobabbrands.com", "royden@baobabbrands.com"];
    }

    // Bookings collection
    match /bookings/{bookingId} {
      // Anyone can create a booking (submit the form)
      allow create: if true;
      // Only admins can read, update, or delete bookings
      allow read, update, delete: if isAdmin();
    }

    // Holes collection
    match /holes/{holeId} {
      // Anyone can read the hole statuses to see what's available
      allow read: if true;
      // Only admins or a transaction initiated by a user creating a booking can write
      // The transaction logic is handled server-side, but rules must allow admin writes.
      allow write: if isAdmin();
    }

    // Messages collection
    match /messages/{messageId} {
      // Anyone can create a message (submit contact form)
      allow create: if true;
      // Only admins can read or delete messages
      allow read, delete: if isAdmin();
    }

    // Reminders collection
    match /reminders/{reminderId} {
        // Anyone can create a reminder signup
        allow create: if true;
        // Only admins can read or delete reminders
        allow read, delete: if isAdmin();
    }
  }
}
